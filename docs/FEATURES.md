# SimpleBlog 機能仕様書

## 1. 概要

SimpleBlogは、Markdown形式でブログ記事を投稿・管理できるシンプルなブログシステムです。

---

## 2. 機能一覧

### 2.1 実装済み機能

| # | 機能名 | 説明 | 優先度 |
|---|--------|------|--------|
| 1 | 管理画面ログイン機能 | メールアドレスとパスワードによる認証 | 高 |
| 2 | Markdown形式ブログ投稿機能 | 管理画面から記事を投稿 | 高 |
| 3 | ブログ編集機能 | 既存の記事を編集 | 高 |
| 4 | ブログ削除機能 | 既存の記事を削除 | 高 |
| 5 | 投稿一覧表示機能 | トップ画面で投稿を一覧表示 | 高 |
| 6 | 記事詳細表示機能 | Markdownをレンダリングして表示 | 高 |
| 7 | トップ画面への戻る機能 | 詳細画面からトップに戻る | 中 |
| 8 | シンタックスハイライト | コードブロックをハイライト表示 | 中 |

---

## 3. 機能詳細

### 3.1 管理画面ログイン機能

**概要**: 管理画面へのアクセスをメールアドレスとパスワードで制限

**アクセス**: `http://localhost/users/sign_in`

**入力項目**:
- メールアドレス（必須）
- パスワード（必須、6文字以上）
- ログイン状態を保持する（オプション）

**処理フロー**:
1. ユーザーがメールアドレスとパスワードを入力
2. Deviseが認証処理を実行
3. 認証成功: 管理画面へリダイレクト
4. 認証失敗: エラーメッセージを表示

**バリデーション**:
- メールアドレス形式の検証
- パスワード最小6文字

**セキュリティ**:
- パスワードはBCryptで暗号化
- CSRF トークンによる保護
- セッションベースの認証

---

### 3.2 Markdown形式ブログ投稿機能

**概要**: 管理画面からMarkdown形式で記事を投稿

**アクセス**: `http://localhost/admin/posts/new`（要認証）

**入力項目**:
- タイトル（必須、最大200文字）
- 本文（必須、Markdown形式）

**サポートするMarkdown記法**:
- 見出し（#, ##, ###）
- 太字（**text**）
- イタリック（*text*）
- リスト（-, *, 番号付き）
- リンク（[text](url)）
- コードブロック（```言語名）
- 引用（> text）
- テーブル
- 取り消し線（~~text~~）

**処理フロー**:
1. ユーザーがタイトルと本文を入力
2. 「投稿する」ボタンをクリック
3. バリデーション実行
4. 成功: データベースに保存し、投稿一覧へリダイレクト
5. 失敗: エラーメッセージを表示

**バリデーション**:
- タイトル: 必須、200文字以内
- 本文: 必須

---

### 3.3 ブログ編集機能

**概要**: 既存の投稿を編集

**アクセス**: `http://localhost/admin/posts/:id/edit`（要認証）

**入力項目**:
- タイトル（必須、最大200文字）
- 本文（必須、Markdown形式）

**表示項目**:
- 投稿日時
- 最終更新日時
- 投稿者

**処理フロー**:
1. 投稿一覧から「編集」をクリック
2. 既存のデータが入力フォームに表示
3. 内容を修正
4. 「更新する」ボタンをクリック
5. バリデーション実行
6. 成功: データベースを更新し、投稿一覧へリダイレクト
7. 失敗: エラーメッセージを表示

**追加機能**:
- プレビューボタン（別タブで現在の記事を表示）
- キャンセルボタン（投稿一覧へ戻る）

---

### 3.4 ブログ削除機能

**概要**: 既存の投稿を削除

**アクセス**: 管理画面の投稿一覧から実行

**処理フロー**:
1. 投稿一覧から「削除」ボタンをクリック
2. 確認ダイアログ表示「投稿を削除してもよろしいですか？」
3. 「OK」をクリック
4. データベースから削除
5. 投稿一覧を再表示
6. 成功メッセージを表示

**注意事項**:
- 削除した投稿は復元できません
- 確認ダイアログで投稿タイトルを表示

---

### 3.5 投稿一覧表示機能

**概要**: トップ画面で全投稿を一覧表示

**アクセス**: `http://localhost/`（認証不要）

**表示項目**:
- サイトタイトル
- 投稿カード
  - タイトル
  - 投稿日時
  - 本文プレビュー（100文字）
  - 投稿者名

**表示順序**: 作成日時の降順（新しい投稿が上）

**処理フロー**:
1. データベースから全投稿を取得
2. 作成日時の降順でソート
3. カード形式で表示
4. カードクリックで記事詳細へ遷移

**UI/UX**:
- レスポンシブデザイン
- カードホバー時のアニメーション
- 投稿がない場合のメッセージ表示

---

### 3.6 記事詳細表示機能

**概要**: Markdown形式の記事を HTMLにレンダリングして表示

**アクセス**: `http://localhost/posts/:id`（認証不要）

**表示項目**:
- 記事タイトル
- 投稿日時
- 投稿者名
- 本文（Markdownレンダリング済み）
- トップページに戻るボタン
- 編集ボタン（ログイン時のみ）

**Markdown レンダリング**:
- Redcarpetを使用してHTMLに変換
- Rougeによるシンタックスハイライト
- リンクは新しいタブで開く
- テーブル対応
- 改行を<br>タグに変換

**スタイリング**:
- 見出しに下線
- コードブロックの背景色
- 引用のスタイリング
- テーブルの枠線

**処理フロー**:
1. URLから投稿IDを取得
2. データベースから投稿を取得
3. Markdownを HTMLに変換
4. レンダリングして表示
5. 投稿が存在しない場合: 404エラー

---

### 3.7 トップ画面への戻る機能

**概要**: 記事詳細画面からトップ画面へ戻る

**実装箇所**:
- 記事詳細画面の下部
- 大きなボタンで視認性を確保

**処理フロー**:
1. 「トップページに戻る」ボタンをクリック
2. トップ画面（`/`）へリダイレクト

**UI/UX**:
- ボタンホバー時のアニメーション
- 矢印アイコン表示

---

### 3.8 シンタックスハイライト機能

**概要**: コードブロックに言語別のシンタックスハイライトを適用

**対応言語**:
- Ruby
- JavaScript
- Python
- HTML/CSS
- SQL
- その他（highlight.jsがサポートする言語）

**使用方法**:
```markdown
\`\`\`ruby
def hello
  puts "Hello, World!"
end
\`\`\`
```

**実装**:
- Redcarpetのfenced_code_blocksオプション
- highlight.jsによるクライアントサイドハイライト
- GitHubスタイルのテーマ

---

## 4. 画面ごとの機能マトリックス

| 画面名 | 閲覧 | 作成 | 編集 | 削除 | 認証 |
|--------|------|------|------|------|------|
| トップ画面 | ✓ | - | - | - | 不要 |
| 記事詳細画面 | ✓ | - | - | - | 不要 |
| ログイン画面 | ✓ | - | - | - | 不要 |
| 管理：投稿一覧 | ✓ | - | - | ✓ | 必要 |
| 管理：新規投稿 | - | ✓ | - | - | 必要 |
| 管理：投稿編集 | ✓ | - | ✓ | - | 必要 |

---

## 5. 非機能要件

### 5.1 パフォーマンス
- ページ読み込み時間: 3秒以内
- データベースクエリの最適化（N+1問題の回避）

### 5.2 セキュリティ
- パスワードの暗号化保存
- CSRF対策
- XSS対策（自動エスケープ）
- SQLインジェクション対策（ORM使用）

### 5.3 ユーザビリティ
- レスポンシブデザイン
- 直感的なUI
- エラーメッセージの明確化
- 日本語ロケール

### 5.4 保守性
- MVCアーキテクチャの採用
- コメントによるコードドキュメント
- 命名規則の統一

---

## 6. 今後の拡張案

以下は将来的に追加を検討できる機能です：

### 6.1 ユーザー管理
- 複数ユーザーのサポート
- 権限管理（管理者、編集者など）

### 6.2 記事管理
- カテゴリー機能
- タグ機能
- 下書き保存機能
- 公開/非公開設定

### 6.3 検索・フィルタ
- 記事検索機能
- カテゴリーフィルタ
- 日付フィルタ

### 6.4 コメント機能
- 読者コメント
- コメント承認機能

### 6.5 画像管理
- 画像アップロード
- 画像ライブラリ

### 6.6 統計・分析
- アクセス解析
- 人気記事ランキング

### 6.7 エクスポート
- Markdown エクスポート
- PDF エクスポート

---

**作成日**: 2025年10月29日  
**バージョン**: 1.0
